Object.defineProperty(exports,"__esModule",{value:true});exports.useAutoScroll=useAutoScroll;var _react=require("react");var _reactNative=require("react-native");var _reactNativeReanimated=require("react-native-reanimated");var _constants=require("../constants");var _propsContext=require("../context/propsContext");var _animatedValueContext=require("../context/animatedValueContext");var _refContext=require("../context/refContext");var OuterScrollState;(function(OuterScrollState){OuterScrollState[OuterScrollState["Idle"]=0]="Idle";OuterScrollState[OuterScrollState["Up"]=1]="Up";OuterScrollState[OuterScrollState["Down"]=2]="Down";})(OuterScrollState||(OuterScrollState={}));var ScrollDir;(function(ScrollDir){ScrollDir[ScrollDir["None"]=0]="None";ScrollDir[ScrollDir["Up"]=-1]="Up";ScrollDir[ScrollDir["Down"]=1]="Down";})(ScrollDir||(ScrollDir={}));function useAutoScroll(outerScrollRef,outerScrollOffset,pointerY,activeKey,pointerType,innerAnimatedRef){var _useRefs=(0,_refContext.useRefs)(),flatlistRef=_useRefs.flatlistRef;var _useProps=(0,_propsContext.useProps)(),_useProps$autoscrollT=_useProps.autoscrollThreshold,autoscrollThreshold=_useProps$autoscrollT===void 0?_constants.DEFAULT_PROPS.autoscrollThreshold:_useProps$autoscrollT,_useProps$autoscrollS=_useProps.autoscrollSpeed,autoscrollSpeed=_useProps$autoscrollS===void 0?_constants.DEFAULT_PROPS.autoscrollSpeed:_useProps$autoscrollS;var _useAnimatedValues=(0,_animatedValueContext.useAnimatedValues)(),scrollOffset=_useAnimatedValues.scrollOffset,scrollViewSize=_useAnimatedValues.scrollViewSize,containerSize=_useAnimatedValues.containerSize,activeCellSize=_useAnimatedValues.activeCellSize,hoverOffset=_useAnimatedValues.hoverOffset,activeIndexAnim=_useAnimatedValues.activeIndexAnim;var hoverScreenOffset=(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){return hoverOffset.value-scrollOffset.value;};_f._closure={hoverOffset:hoverOffset,scrollOffset:scrollOffset};_f.asString="function _f(){const{hoverOffset,scrollOffset}=jsThis._closure;{return hoverOffset.value-scrollOffset.value;}}";_f.__workletHash=10763890843319;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (129:44)";return _f;}());var isScrolledUp=(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){return scrollOffset.value-_constants.SCROLL_POSITION_TOLERANCE<=0;};_f._closure={scrollOffset:scrollOffset,SCROLL_POSITION_TOLERANCE:_constants.SCROLL_POSITION_TOLERANCE};_f.asString="function _f(){const{scrollOffset,SCROLL_POSITION_TOLERANCE}=jsThis._closure;{return scrollOffset.value-SCROLL_POSITION_TOLERANCE<=0;}}";_f.__workletHash=15578879662595;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (135:4)";return _f;}());var isScrolledDown=(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){return scrollOffset.value+containerSize.value+_constants.SCROLL_POSITION_TOLERANCE>=scrollViewSize.value;};_f._closure={scrollOffset:scrollOffset,containerSize:containerSize,SCROLL_POSITION_TOLERANCE:_constants.SCROLL_POSITION_TOLERANCE,scrollViewSize:scrollViewSize};_f.asString="function _f(){const{scrollOffset,containerSize,SCROLL_POSITION_TOLERANCE,scrollViewSize}=jsThis._closure;{return scrollOffset.value+containerSize.value+SCROLL_POSITION_TOLERANCE>=scrollViewSize.value;}}";_f.__workletHash=7372520673244;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (139:4)";return _f;}());var distToTopEdge=(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){return Math.max(0,hoverScreenOffset.value);};_f._closure={hoverScreenOffset:hoverScreenOffset};_f.asString="function _f(){const{hoverScreenOffset}=jsThis._closure;{return Math.max(0,hoverScreenOffset.value);}}";_f.__workletHash=5945680760068;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (147:40)";return _f;}());var distToBottomEdge=(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){var hoverPlus=hoverScreenOffset.value+activeCellSize.value;return Math.max(0,containerSize.value-hoverPlus);};_f._closure={hoverScreenOffset:hoverScreenOffset,activeCellSize:activeCellSize,containerSize:containerSize};_f.asString="function _f(){const{hoverScreenOffset,activeCellSize,containerSize}=jsThis._closure;{const hoverPlus=hoverScreenOffset.value+activeCellSize.value;return Math.max(0,containerSize.value-hoverPlus);}}";_f.__workletHash=3123380205153;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (149:43)";return _f;}());var isAtTopEdge=(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){return distToTopEdge.value<=autoscrollThreshold;};_f._closure={distToTopEdge:distToTopEdge,autoscrollThreshold:autoscrollThreshold};_f.asString="function _f(){const{distToTopEdge,autoscrollThreshold}=jsThis._closure;{return distToTopEdge.value<=autoscrollThreshold;}}";_f.__workletHash=499688299934;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (156:4)";return _f;}());var isAtBottomEdge=(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){return distToBottomEdge.value<=autoscrollThreshold;};_f._closure={distToBottomEdge:distToBottomEdge,autoscrollThreshold:autoscrollThreshold};_f.asString="function _f(){const{distToBottomEdge,autoscrollThreshold}=jsThis._closure;{return distToBottomEdge.value<=autoscrollThreshold;}}";_f.__workletHash=10361122491518;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (160:4)";return _f;}());var scrollTarget=(0,_reactNativeReanimated.useSharedValue)(0);var dragActive=(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){return activeIndexAnim.value>=0;};_f._closure={activeIndexAnim:activeIndexAnim};_f.asString="function _f(){const{activeIndexAnim}=jsThis._closure;{return activeIndexAnim.value>=0;}}";_f.__workletHash=16254827243008;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (167:37)";return _f;}());(0,_reactNativeReanimated.useAnimatedReaction)(function(){var _f=function _f(){return dragActive.value;};_f._closure={dragActive:dragActive};_f.asString="function _f(){const{dragActive}=jsThis._closure;{return dragActive.value;}}";_f.__workletHash=11662601692947;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (171:4)";return _f;}(),function(){var _f=function _f(cur,prev){if(cur&&!prev)scrollTarget.value=scrollOffset.value;};_f._closure={scrollTarget:scrollTarget,scrollOffset:scrollOffset};_f.asString="function _f(cur,prev){const{scrollTarget,scrollOffset}=jsThis._closure;{if(cur&&!prev)scrollTarget.value=scrollOffset.value;}}";_f.__workletHash=5663374574222;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (172:4)";return _f;}());var shouldScrollInner=(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){var diff=Math.abs(scrollTarget.value-scrollOffset.value);var reached=diff<_constants.SCROLL_POSITION_TOLERANCE;var atEdge=isAtTopEdge.value||isAtBottomEdge.value;var blocked=isAtTopEdge.value&&isScrolledUp.value||isAtBottomEdge.value&&isScrolledDown.value;return reached&&atEdge&&!blocked&&dragActive.value;};_f._closure={scrollTarget:scrollTarget,scrollOffset:scrollOffset,SCROLL_POSITION_TOLERANCE:_constants.SCROLL_POSITION_TOLERANCE,isAtTopEdge:isAtTopEdge,isAtBottomEdge:isAtBottomEdge,isScrolledUp:isScrolledUp,isScrolledDown:isScrolledDown,dragActive:dragActive};_f.asString="function _f(){const{scrollTarget,scrollOffset,SCROLL_POSITION_TOLERANCE,isAtTopEdge,isAtBottomEdge,isScrolledUp,isScrolledDown,dragActive}=jsThis._closure;{const diff=Math.abs(scrollTarget.value-scrollOffset.value);const reached=diff<SCROLL_POSITION_TOLERANCE;const atEdge=isAtTopEdge.value||isAtBottomEdge.value;const blocked=isAtTopEdge.value&&isScrolledUp.value||isAtBottomEdge.value&&isScrolledDown.value;return reached&&atEdge&&!blocked&&dragActive.value;}}";_f.__workletHash=10343403999076;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (178:44)";return _f;}());(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){if(!shouldScrollInner.value)return;if(!innerAnimatedRef)return;var dist=isAtTopEdge.value?distToTopEdge.value:distToBottomEdge.value;var pct=1-dist/autoscrollThreshold;var delta=pct*autoscrollSpeed;var next=isAtTopEdge.value?Math.max(0,scrollOffset.value-delta):Math.min(scrollOffset.value+delta,scrollViewSize.value-containerSize.value);scrollTarget.value=next;(0,_reactNativeReanimated.scrollTo)(innerAnimatedRef,0,next,false);scrollOffset.value=next;};_f._closure={shouldScrollInner:shouldScrollInner,innerAnimatedRef:innerAnimatedRef,isAtTopEdge:isAtTopEdge,distToTopEdge:distToTopEdge,distToBottomEdge:distToBottomEdge,autoscrollThreshold:autoscrollThreshold,autoscrollSpeed:autoscrollSpeed,scrollOffset:scrollOffset,scrollViewSize:scrollViewSize,containerSize:containerSize,scrollTarget:scrollTarget,scrollTo:_reactNativeReanimated.scrollTo};_f.asString="function _f(){const{shouldScrollInner,innerAnimatedRef,isAtTopEdge,distToTopEdge,distToBottomEdge,autoscrollThreshold,autoscrollSpeed,scrollOffset,scrollViewSize,containerSize,scrollTarget,scrollTo}=jsThis._closure;{if(!shouldScrollInner.value)return;if(!innerAnimatedRef)return;const dist=isAtTopEdge.value?distToTopEdge.value:distToBottomEdge.value;const pct=1-dist/autoscrollThreshold;const delta=pct*autoscrollSpeed;const next=isAtTopEdge.value?Math.max(0,scrollOffset.value-delta):Math.min(scrollOffset.value+delta,scrollViewSize.value-containerSize.value);scrollTarget.value=next;scrollTo(innerAnimatedRef,0,next,false);scrollOffset.value=next;}}";_f.__workletHash=301881848230;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (193:18)";return _f;}());if(!outerScrollRef||!outerScrollOffset)return;var outerState=(0,_reactNativeReanimated.useSharedValue)(OuterScrollState.Idle);var outerTopY=(0,_reactNativeReanimated.useSharedValue)(0);var outerBottomY=(0,_reactNativeReanimated.useSharedValue)(0);var attemptedOff=(0,_reactNativeReanimated.useSharedValue)(0);var lastDir=(0,_reactNativeReanimated.useSharedValue)(ScrollDir.None);(0,_react.useEffect)(function(){var node=outerScrollRef==null?void 0:outerScrollRef.current;if(!node||(pointerType==null?void 0:pointerType.value)===2)return;var setScrollEnabled=function setScrollEnabled(enabled){if(typeof node.setNativeProps==="function"){node.setNativeProps({scrollEnabled:enabled});}else if(node.style){var el=node;el.style.overflowY=enabled?"auto":"hidden";el.style.overscrollBehavior=enabled?"auto":"contain";}};var locked=activeKey!=null;setScrollEnabled(!locked);return function(){setScrollEnabled(true);};},[activeKey,outerScrollRef,pointerType]);(0,_react.useEffect)(function(){if(!(outerScrollRef!=null&&outerScrollRef.current))return;var measure=function measure(){var _outerScrollRef$curre;(_outerScrollRef$curre=outerScrollRef.current)==null?void 0:_outerScrollRef$curre.measureInWindow(function(_,y,__,h){outerTopY.value=y;outerBottomY.value=y+h;});};measure();var dimSub=_reactNative.Dimensions.addEventListener("change",measure);var ro;if(_constants.isWeb&&typeof window!=="undefined"&&window.ResizeObserver){var el=outerScrollRef.current;var ROs=window.ResizeObserver;ro=new ROs(measure);ro.observe(el);}return function(){var _ro;dimSub.remove();(_ro=ro)==null?void 0:_ro.disconnect();};},[outerScrollRef]);(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){var y=pointerY==null?void 0:pointerY.value;if(y==null||activeKey==null){outerState.value=OuterScrollState.Idle;return;}if(y<outerTopY.value+autoscrollThreshold){outerState.value=OuterScrollState.Up;}else if(y>outerBottomY.value-autoscrollThreshold){outerState.value=OuterScrollState.Down;}else{outerState.value=OuterScrollState.Idle;}};_f._closure={pointerY:pointerY,activeKey:activeKey,outerState:outerState,OuterScrollState:{Idle:OuterScrollState.Idle,Up:OuterScrollState.Up,Down:OuterScrollState.Down},outerTopY:outerTopY,autoscrollThreshold:autoscrollThreshold,outerBottomY:outerBottomY};_f.asString="function _f(){const{pointerY,activeKey,outerState,OuterScrollState,outerTopY,autoscrollThreshold,outerBottomY}=jsThis._closure;{var _pointerY;const y=(_pointerY=pointerY)===null||_pointerY===void 0?void 0:_pointerY.value;if(y==null||activeKey==null){outerState.value=OuterScrollState.Idle;return;}if(y<outerTopY.value+autoscrollThreshold){outerState.value=OuterScrollState.Up;}else if(y>outerBottomY.value-autoscrollThreshold){outerState.value=OuterScrollState.Down;}else{outerState.value=OuterScrollState.Idle;}}}";_f.__workletHash=7297738748553;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (299:18)";return _f;}());(0,_reactNativeReanimated.useDerivedValue)(function(){var _f=function _f(){if(outerState.value===OuterScrollState.Idle||activeKey==null||(pointerY==null?void 0:pointerY.value)==null)return;var dist=outerState.value===OuterScrollState.Up?pointerY.value-outerTopY.value:outerBottomY.value-pointerY.value;var pct=1-dist/autoscrollThreshold;if(pct<=0)return;var dir=outerState.value===OuterScrollState.Up?ScrollDir.Up:ScrollDir.Down;var delta=pct*autoscrollSpeed*dir;attemptedOff.value=outerScrollOffset.value+delta;lastDir.value=dir;(0,_reactNativeReanimated.scrollTo)(outerScrollRef,0,attemptedOff.value,false);};_f._closure={outerState:outerState,OuterScrollState:{Idle:OuterScrollState.Idle,Up:OuterScrollState.Up},activeKey:activeKey,pointerY:pointerY,outerTopY:outerTopY,outerBottomY:outerBottomY,autoscrollThreshold:autoscrollThreshold,ScrollDir:{Up:ScrollDir.Up,Down:ScrollDir.Down},autoscrollSpeed:autoscrollSpeed,attemptedOff:attemptedOff,outerScrollOffset:outerScrollOffset,lastDir:lastDir,scrollTo:_reactNativeReanimated.scrollTo,outerScrollRef:outerScrollRef};_f.asString="function _f(){const{outerState,OuterScrollState,activeKey,pointerY,outerTopY,outerBottomY,autoscrollThreshold,ScrollDir,autoscrollSpeed,attemptedOff,outerScrollOffset,lastDir,scrollTo,outerScrollRef}=jsThis._closure;{var _pointerY;if(outerState.value===OuterScrollState.Idle||activeKey==null||((_pointerY=pointerY)===null||_pointerY===void 0?void 0:_pointerY.value)==null)return;const dist=outerState.value===OuterScrollState.Up?pointerY.value-outerTopY.value:outerBottomY.value-pointerY.value;const pct=1-dist/autoscrollThreshold;if(pct<=0)return;const dir=outerState.value===OuterScrollState.Up?ScrollDir.Up:ScrollDir.Down;const delta=pct*autoscrollSpeed*dir;attemptedOff.value=outerScrollOffset.value+delta;lastDir.value=dir;scrollTo(outerScrollRef,0,attemptedOff.value,false);}}";_f.__workletHash=5116009750413;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (317:18)";return _f;}());(0,_reactNativeReanimated.useAnimatedReaction)(function(){var _f=function _f(){return outerScrollOffset.value;};_f._closure={outerScrollOffset:outerScrollOffset};_f.asString="function _f(){const{outerScrollOffset}=jsThis._closure;{return outerScrollOffset.value;}}";_f.__workletHash=16979260651603;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (347:4)";return _f;}(),function(){var _f=function _f(cur,prev){if(outerState.value===OuterScrollState.Idle||prev==null)return;var moved=lastDir.value===ScrollDir.Down?cur>prev:cur<prev;if(!moved)outerState.value=OuterScrollState.Idle;};_f._closure={outerState:outerState,OuterScrollState:{Idle:OuterScrollState.Idle},lastDir:lastDir,ScrollDir:{Down:ScrollDir.Down}};_f.asString="function _f(cur,prev){const{outerState,OuterScrollState,lastDir,ScrollDir}=jsThis._closure;{if(outerState.value===OuterScrollState.Idle||prev==null)return;const moved=lastDir.value===ScrollDir.Down?cur>prev:cur<prev;if(!moved)outerState.value=OuterScrollState.Idle;}}";_f.__workletHash=96831690014;_f.__location="/home/runner/work/react-native-draggable-flatlist/react-native-draggable-flatlist/src/hooks/useAutoScroll.tsx (348:4)";return _f;}());}
//# sourceMappingURL=useAutoScroll.js.map