{"version":3,"names":["React","useCallback","useEffect","useLayoutEffect","useMemo","useRef","useState","InteractionManager","FlatList","Gesture","GestureDetector","Animated","runOnJS","useAnimatedReaction","useAnimatedScrollHandler","useSharedValue","withSpring","useAnimatedRef","CellRendererComponent","DEFAULT_PROPS","isWeb","PlaceholderItem","RowItem","PropsProvider","AnimatedValueProvider","useAnimatedValues","RefProvider","useRefs","DraggableFlatListProvider","useAutoScroll","useStableCallback","ScrollOffsetListener","typedMemo","AnimatedFlatList","createAnimatedComponent","DraggableFlatListInner","props","cellDataRef","containerRef","keyToIndexRef","propsRef","animationConfigRef","activeCellOffset","activeCellSize","activeIndexAnim","containerSize","scrollOffset","scrollViewSize","spacerIndexAnim","horizontalAnim","placeholderOffset","touchTranslate","autoScrollDistance","panGestureState","isTouchActiveNative","viewableIndexMin","viewableIndexMax","disabled","flatlistAnimatedRef","reset","value","setActiveKey","dragHitSlop","scrollEnabled","activationDistance","activationDistanceProp","activeKey","layoutAnimationDisabled","setLayoutAnimationDisabled","current","enableLayoutAnimationExperimental","keyExtractor","item","index","Error","dataRef","data","dataHasChanged","map","join","runAfterInteractions","setTimeout","forEach","d","i","key","set","drag","get","cellData","measurements","offset","size","onDragBegin","undefined","onContainerLayout","nativeEvent","layout","width","height","horizontal","onListContentSizeChange","w","h","onContentSizeChange","onContainerTouchStart","onContainerTouchEnd","extraData","renderItem","onRelease","onDragEnd","from","to","newData","splice","onPlaceholderIndexChange","cur","prev","hasMoved","gestureDisabled","pointerY","pointerType","panGesture","Pan","onBegin","evt","state","onUpdate","translation","translationX","translationY","absoluteY","onEnd","springTo","onTouchesDown","onTouchesUp","minDistance","hitSlop","activeOffset","activeOffsetX","activeOffsetY","onScroll","onScrollOffsetChange","scrollHandler","contentOffset","x","y","outerScrollRef","outerScrollOffset","onViewableItemsChanged","info","viewableIndices","viewableItems","filter","isViewable","min","Math","max","propsForFlatList","autoscrollThreshold","autoscrollSpeed","containerStyle","renderPlaceholder","simultaneousHandlers","DraggableFlatList","ref","MemoizedInner","forwardRef"],"sources":["DraggableFlatList.tsx"],"sourcesContent":["import React, {\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\";\nimport {\n  ListRenderItem,\n  FlatListProps,\n  LayoutChangeEvent,\n  InteractionManager,\n} from \"react-native\";\nimport {\n  FlatList,\n  Gesture,\n  GestureDetector,\n} from \"react-native-gesture-handler\";\nimport Animated, {\n  runOnJS,\n  useAnimatedReaction,\n  useAnimatedScrollHandler,\n  useSharedValue,\n  withSpring,\n  useAnimatedRef, //@madebylo\n} from \"react-native-reanimated\";\nimport CellRendererComponent from \"./CellRendererComponent\";\nimport { DEFAULT_PROPS, isWeb } from \"../constants\"; //@madebylo\nimport PlaceholderItem from \"./PlaceholderItem\";\nimport RowItem from \"./RowItem\";\nimport { DraggableFlatListProps } from \"../types\";\nimport PropsProvider from \"../context/propsContext\";\nimport AnimatedValueProvider, {\n  useAnimatedValues,\n} from \"../context/animatedValueContext\";\nimport RefProvider, { useRefs } from \"../context/refContext\";\nimport DraggableFlatListProvider from \"../context/draggableFlatListContext\";\nimport { useAutoScroll } from \"../hooks/useAutoScroll\";\nimport { useStableCallback } from \"../hooks/useStableCallback\";\nimport ScrollOffsetListener from \"./ScrollOffsetListener\";\nimport { typedMemo } from \"../utils\";\n\ntype RNGHFlatListProps<T> = Animated.AnimateProps<\n  FlatListProps<T> & {\n    ref: React.Ref<FlatList<T>>;\n    simultaneousHandlers?: React.Ref<any> | React.Ref<any>[];\n  }\n>;\n\ntype OnViewableItemsChangedCallback<T> = Exclude<\n  FlatListProps<T>[\"onViewableItemsChanged\"],\n  undefined | null\n>;\n\nconst AnimatedFlatList = (Animated.createAnimatedComponent(\n  FlatList\n) as unknown) as <T>(props: RNGHFlatListProps<T>) => React.ReactElement;\n\nfunction DraggableFlatListInner<T>(props: DraggableFlatListProps<T>) {\n  const {\n    cellDataRef,\n    containerRef,\n    keyToIndexRef,\n    propsRef,\n    animationConfigRef,\n  } = useRefs<T>();\n  const {\n    activeCellOffset,\n    activeCellSize,\n    activeIndexAnim,\n    containerSize,\n    scrollOffset,\n    scrollViewSize,\n    spacerIndexAnim,\n    horizontalAnim,\n    placeholderOffset,\n    touchTranslate,\n    autoScrollDistance,\n    panGestureState,\n    isTouchActiveNative,\n    viewableIndexMin,\n    viewableIndexMax,\n    disabled,\n  } = useAnimatedValues();\n\n  const flatlistAnimatedRef = useAnimatedRef<FlatList<any>>(); //@madebylo\n\n  const reset = useStableCallback(() => {\n    activeIndexAnim.value = -1;\n    spacerIndexAnim.value = -1;\n    touchTranslate.value = 0;\n    activeCellSize.value = -1;\n    activeCellOffset.value = -1;\n    setActiveKey(null);\n  });\n\n  const {\n    dragHitSlop = DEFAULT_PROPS.dragHitSlop,\n    scrollEnabled = DEFAULT_PROPS.scrollEnabled,\n    activationDistance: activationDistanceProp = DEFAULT_PROPS.activationDistance,\n  } = props;\n\n  let [activeKey, setActiveKey] = useState<string | null>(null);\n  const [layoutAnimationDisabled, setLayoutAnimationDisabled] = useState(\n    !propsRef.current.enableLayoutAnimationExperimental\n  );\n\n  const keyExtractor = useStableCallback((item: T, index: number) => {\n    if (!props.keyExtractor) {\n      throw new Error(\"You must provide a keyExtractor to DraggableFlatList\");\n    }\n    return props.keyExtractor(item, index);\n  });\n\n  const dataRef = useRef(props.data);\n  const dataHasChanged =\n    dataRef.current.map(keyExtractor).join(\"\") !==\n    props.data.map(keyExtractor).join(\"\");\n  dataRef.current = props.data;\n  if (dataHasChanged) {\n    // When data changes make sure `activeKey` is nulled out in the same render pass\n    activeKey = null;\n    InteractionManager.runAfterInteractions(() => {\n      reset();\n    });\n  }\n\n  useEffect(() => {\n    if (!propsRef.current.enableLayoutAnimationExperimental) return;\n    if (activeKey) {\n      setLayoutAnimationDisabled(true);\n    } else {\n      // setTimeout result of trial-and-error to determine how long to wait before\n      // re-enabling layout animations so that a drag reorder does not trigger it.\n      setTimeout(() => {\n        setLayoutAnimationDisabled(false);\n      }, 100);\n    }\n  }, [activeKey]);\n\n  useLayoutEffect(() => {\n    props.data.forEach((d, i) => {\n      const key = keyExtractor(d, i);\n      keyToIndexRef.current.set(key, i);\n    });\n  }, [props.data, keyExtractor, keyToIndexRef]);\n\n  const drag = useStableCallback((activeKey: string) => {\n    if (disabled.value) return;\n    const index = keyToIndexRef.current.get(activeKey);\n    const cellData = cellDataRef.current.get(activeKey);\n    if (cellData) {\n      activeCellOffset.value = cellData.measurements.offset;\n      activeCellSize.value = cellData.measurements.size;\n    }\n\n    const { onDragBegin } = propsRef.current;\n    if (index !== undefined) {\n      spacerIndexAnim.value = index;\n      activeIndexAnim.value = index;\n      setActiveKey(activeKey);\n      onDragBegin?.(index);\n    }\n  });\n\n  const onContainerLayout = ({\n    nativeEvent: { layout },\n  }: LayoutChangeEvent) => {\n    const { width, height } = layout;\n    containerSize.value = props.horizontal ? width : height;\n    props.onContainerLayout?.({ layout, containerRef });\n  };\n\n  const onListContentSizeChange = (w: number, h: number) => {\n    scrollViewSize.value = props.horizontal ? w : h;\n    props.onContentSizeChange?.(w, h);\n  };\n\n  const onContainerTouchStart = () => {\n    if (!disabled.value) {\n      isTouchActiveNative.value = true;\n    }\n    return false;\n  };\n\n  const onContainerTouchEnd = () => {\n    isTouchActiveNative.value = false;\n  };\n\n  const extraData = useMemo(\n    () => ({\n      activeKey,\n      extraData: props.extraData,\n    }),\n    [activeKey, props.extraData]\n  );\n\n  const renderItem: ListRenderItem<T> = useCallback(\n    ({ item, index }) => {\n      const key = keyExtractor(item, index);\n      if (index !== keyToIndexRef.current.get(key)) {\n        keyToIndexRef.current.set(key, index);\n      }\n\n      return (\n        <RowItem\n          item={item}\n          itemKey={key}\n          renderItem={props.renderItem}\n          drag={drag}\n          extraData={props.extraData}\n        />\n      );\n    },\n    [props.renderItem, props.extraData, drag, keyExtractor]\n  );\n\n  const onRelease = useStableCallback((index: number) => {\n    props.onRelease?.(index);\n  });\n\n  const onDragEnd = useStableCallback(\n    ({ from, to }: { from: number; to: number }) => {\n      const { onDragEnd, data } = props;\n\n      const newData = [...data];\n      if (from !== to) {\n        newData.splice(from, 1);\n        newData.splice(to, 0, data[from]);\n      }\n\n      onDragEnd?.({ from, to, data: newData });\n\n      setActiveKey(null);\n    }\n  );\n\n  const onPlaceholderIndexChange = useStableCallback((index: number) => {\n    props.onPlaceholderIndexChange?.(index);\n  });\n\n  // Handle case where user ends drag without moving their finger.\n  useAnimatedReaction(\n    () => {\n      return isTouchActiveNative.value;\n    },\n    (cur, prev) => {\n      if (cur !== prev && !cur) {\n        const hasMoved = !!touchTranslate.value;\n        if (!hasMoved && activeIndexAnim.value >= 0 && !disabled.value) {\n          runOnJS(onRelease)(activeIndexAnim.value);\n          runOnJS(onDragEnd)({\n            from: activeIndexAnim.value,\n            to: spacerIndexAnim.value,\n          });\n        }\n      }\n    },\n    [isTouchActiveNative, onDragEnd, onRelease]\n  );\n\n  useAnimatedReaction(\n    () => {\n      return spacerIndexAnim.value;\n    },\n    (cur, prev) => {\n      if (prev !== null && cur !== prev && cur >= 0 && prev >= 0) {\n        runOnJS(onPlaceholderIndexChange)(cur);\n      }\n    },\n    [spacerIndexAnim]\n  );\n\n  const gestureDisabled = useSharedValue(false);\n\n  const pointerY = useSharedValue<number | null>(null); //@madebylo\n  const pointerType = useSharedValue(0); // 0 = TOUCH, 1 = STYLUS, 2 = MOUSE, 3 = KEY, 4  OTHER //@madebylo\n\n\n  const panGesture = Gesture.Pan()\n    .onBegin((evt) => {\n      gestureDisabled.value = disabled.value;\n      if (gestureDisabled.value) return;\n      panGestureState.value = evt.state;\n      pointerType.value = evt.pointerType; //@madebylo\n    })\n    .onUpdate((evt) => {\n      if (gestureDisabled.value) return;\n      panGestureState.value = evt.state;\n      const translation = horizontalAnim.value\n        ? evt.translationX\n        : evt.translationY;\n      touchTranslate.value = translation;\n      pointerY.value = evt.absoluteY //@madebylo\n    })\n    .onEnd((evt) => {\n      pointerY.value = null; //@madebylo\n      if (gestureDisabled.value) return;\n      // Set touch val to current translate val\n      isTouchActiveNative.value = false;\n      const translation = horizontalAnim.value\n        ? evt.translationX\n        : evt.translationY;\n\n      touchTranslate.value = translation + autoScrollDistance.value;\n      panGestureState.value = evt.state;\n\n      // Only call onDragEnd if actually dragging a cell\n      if (activeIndexAnim.value === -1 || disabled.value) return;\n      disabled.value = true;\n      runOnJS(onRelease)(activeIndexAnim.value);\n      const springTo = placeholderOffset.value - activeCellOffset.value;\n      touchTranslate.value = withSpring(\n        springTo,\n        animationConfigRef.value,\n        () => {\n          runOnJS(onDragEnd)({\n            from: activeIndexAnim.value,\n            to: spacerIndexAnim.value,\n          });\n          disabled.value = false;\n        }\n      );\n    })\n    .onTouchesDown(() => {\n      runOnJS(onContainerTouchStart)();\n    })\n    .onTouchesUp(() => {\n      // Turning this into a worklet causes timing issues. We want it to run\n      // just after the finger lifts.\n      pointerY.value = null //@madebylo\n      runOnJS(onContainerTouchEnd)();\n    });\n\n  if (isWeb) panGesture.minDistance(0); //@madebylo\n  if (dragHitSlop) panGesture.hitSlop(dragHitSlop);\n  if (activationDistanceProp) {\n    const activeOffset = [-activationDistanceProp, activationDistanceProp];\n    if (props.horizontal) {\n      //@ts-ignore\n      panGesture.activeOffsetX(activeOffset);\n    } else {\n      //@ts-ignore\n      panGesture.activeOffsetY(activeOffset);\n    }\n  }\n\n  const onScroll = useStableCallback((scrollOffset: number) => {\n    props.onScrollOffsetChange?.(scrollOffset);\n  });\n\n  const scrollHandler = useAnimatedScrollHandler(\n    {\n      onScroll: (evt) => {\n        scrollOffset.value = horizontalAnim.value\n          ? evt.contentOffset.x\n          : evt.contentOffset.y;\n        runOnJS(onScroll)(scrollOffset.value);\n      },\n    },\n    [horizontalAnim]\n  );\n\n  useAutoScroll( // @madebylo\n   props.outerScrollRef,       // undefined ⇒ FlatList scrollt sich selbst\n   props.outerScrollOffset,    // SharedValue oder undefined\n   pointerY,                   // Zeiger-Y\n   activeKey,                  // für Lock/Unlock\n   pointerType,                // Maus-Erkennung\n    flatlistAnimatedRef,        // <- NEU: Referenz auf den FlatList-Ref\n  );\n\n  const onViewableItemsChanged = useStableCallback<\n    OnViewableItemsChangedCallback<T>\n  >((info) => {\n    const viewableIndices = info.viewableItems\n      .filter((item) => item.isViewable)\n      .map((item) => item.index)\n      .filter((index): index is number => typeof index === \"number\");\n\n    const min = Math.min(...viewableIndices);\n    const max = Math.max(...viewableIndices);\n    viewableIndexMin.value = min;\n    viewableIndexMax.value = max;\n    props.onViewableItemsChanged?.(info);\n  });\n\n  const propsForFlatList = { ...props } //@madebylo\n  delete propsForFlatList.outerScrollRef;\n  delete propsForFlatList.outerScrollOffset;\n  delete propsForFlatList.autoscrollThreshold;\n  delete propsForFlatList.autoscrollSpeed;\n\n  return (\n    <DraggableFlatListProvider\n      activeKey={activeKey}\n      keyExtractor={keyExtractor}\n      horizontal={!!props.horizontal}\n      layoutAnimationDisabled={layoutAnimationDisabled}\n    >\n      <GestureDetector gesture={panGesture} touchAction={props.horizontal ? \"pan-x\" : \"pan-y\"} userSelect=\"none\"> \n        <Animated.View\n          style={props.containerStyle}\n          ref={containerRef}\n          onLayout={onContainerLayout}\n        >\n          {props.renderPlaceholder && (\n            <PlaceholderItem renderPlaceholder={props.renderPlaceholder} />\n          )}\n          <AnimatedFlatList\n            {...propsForFlatList} //@madebylo\n            data={props.data}\n            onViewableItemsChanged={onViewableItemsChanged}\n            CellRendererComponent={CellRendererComponent}\n            ref={flatlistAnimatedRef} //@madebylo\n            onContentSizeChange={onListContentSizeChange}\n            scrollEnabled={!activeKey && scrollEnabled}\n            renderItem={renderItem}\n            extraData={extraData}\n            keyExtractor={keyExtractor}\n            onScroll={scrollHandler}\n            scrollEventThrottle={16}\n            simultaneousHandlers={props.simultaneousHandlers}\n            removeClippedSubviews={false}\n          />\n          {!!props.onScrollOffsetChange && (\n            <ScrollOffsetListener\n              onScrollOffsetChange={props.onScrollOffsetChange}\n              scrollOffset={scrollOffset}\n            />\n          )}\n        </Animated.View>\n      </GestureDetector>\n    </DraggableFlatListProvider>\n  );\n}\n\nfunction DraggableFlatList<T>(\n  props: DraggableFlatListProps<T>,\n  ref?: React.ForwardedRef<FlatList<T>> | null\n) {\n  return (\n    <PropsProvider {...props}>\n      <AnimatedValueProvider>\n        <RefProvider flatListRef={ref}>\n          <MemoizedInner {...props} />\n        </RefProvider>\n      </AnimatedValueProvider>\n    </PropsProvider>\n  );\n}\n\nconst MemoizedInner = typedMemo(DraggableFlatListInner);\n\n// Generic forwarded ref type assertion taken from:\n// https://fettblog.eu/typescript-react-generic-forward-refs/#option-1%3A-type-assertion\nexport default React.forwardRef(DraggableFlatList) as <T>(\n  props: DraggableFlatListProps<T> & { ref?: React.ForwardedRef<FlatList<T>> }\n) => ReturnType<typeof DraggableFlatList>;\n"],"mappings":"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"}